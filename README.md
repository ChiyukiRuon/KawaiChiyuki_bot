# Telegram机器人-千雪酱(KawaiChiyuki_bot)
***
<!-- TOC -->
* [Telegram机器人-千雪酱(KawaiChiyuki_bot)](#telegram机器人-千雪酱--kawaichiyukibot-)
  * [机器人功能](#机器人功能)
    * [Pixiv](#pixiv)
    * [一言](#一言)
    * [Bangumi番剧日程表](#bangumi番剧日程表)
    * [KFC疯狂星期四](#kfc疯狂星期四)
  * [关于](#关于)
  * [更新日志](#更新日志)
    * [2023.03.08](#20230308)
    * [2023.03.07](#20230307)
    * [2023.01.16](#20230116)
    * [2023.01.13](#20230113)
    * [2023.01.09](#20230109)
    * [2022.10.29](#20221029)
    * [2022.10.26](#20221026)
    * [2022.10.22](#20221022)
    * [2022.10.21](#20221021)
    * [2022.10.20](#20221020)
    * [2022.10.19](#20221019)
    * [2022.10.18](#20221018)
  * [TODO](#todo)
  * [第三方API](#第三方api)
<!-- TOC -->
***
## 机器人功能
> `{}`中的内容表示必填参数，`[]`中的参数表示选填参数，`|`分隔表示括号中的参数选一个即可

### Pixiv
- `/{day|week|month}_rank [page]` 获取`Pixiv{日|周|月}榜`的图片
- `/{day|week}_rank_r18 [page]` 获取`Pixiv R18{日|周}榜`的图片
- `/rank_g18g [page]` 获取`Pixiv R18G排行榜`的图片
> 上述命令默认发送排行榜第一张图片，点击消息下方的按钮浏览下一张或上一张图片。在命令后加上一个整数可以获取指定位置的图片,范围为1到30或-30到-1之间的整数。  
> 例：`/day_rank 2`  
> 获取Pixiv日榜第2张图片  
> 若页数为负数则是倒序发送
- `/sese` 随机获取Pixiv的图片

### 一言
- `/yan` 一言二次元语录

### Bangumi番剧日程表
- `/bangumi [weekday]` 获取当日更新的番剧，可选参数`weekday`的范围为`1-7`，代表周一到周日
> 例：`/bangumi 1` 获取周一更新的番剧
> 你也可以在使用命令后通过点击消息下方的按钮查看你想知道的其他日期的番剧日程表

### KFC疯狂星期四
- `/crazy_kfc` 获取一段KFC疯狂星期四文案
***

## 关于
一时兴起写的tg机器人，Python也是约等于没学过，边学边写，有不足的地方还请多多包涵
***

## 更新日志
### 2023.03.08
- 优化
  1. 将缓存管理分为写入缓存与清除缓存两个方法

### 2023.03.07
- 新增
  1. 添加了疯狂星期四文案功能
  2. 实现拦截同一用户短时间内的多次请求
- 修复
  1. 修复了过期缓存无法删除的问题
- 优化
  1. 优化了更新日志的格式

### 2023.01.16
- 新增
  1. 实现Pixiv排行榜缓存
- 修复
  1. 修复了README的显示问题

### 2023.01.13
- 修复
  1. 修改了HibiAPI的链接
- 优化
  1. 优化发送Pixiv排行榜图片的形式
  2. 调整了代码结构，优化了部分函数的日志输出
  3. 为获取Pixiv图片添加了备用API，在一个API出错时会尝试切换到备用API
  4. 修改了README，以对应更改的功能

### 2023.01.09
- 新增
  1. 使用统一的方法输出日志，并对日志进行保存
- 优化
  1. 为`/help`,`/bangumi`,`/sese`功能增加了交互按钮，便于使用
  2. 修改了README样式
  3. 调整了代码结构
- 删除
  1. 删除了一些不必要的文件

### 2022.10.29
- 新增
  1. 添加专门的函数输出发送/接收信息的日志，并完善了日志信息
- 优化
  1. 整理了一下代码结构 ~~（以后有时间会再好好整理）~~
  2. 完善了代码中的注释

### 2022.10.26
- 新增
  1. 添加了番剧日历的功能
- 优化
  1. 完善了一些函数的日志输出
  2. 修改了对于机器人功能的表述

### 2022.10.22
- 新增
  1. 添加了一言功能
- 优化
  1. 修改了日志输出格式

### 2022.10.21
- 新增
  1. 实现了随机获取Pixiv图片
- 优化
  1. 完善了控制台输出的日志信息，在发送图片失败时会发送错误信息

### 2022.10.20
- 优化
  1. 能发送的Pixiv图片不再限于前五张了,在命令后跟上页数以获取更多图片

### 2022.10.19
- 优化
  1. 在发送图片失败时会发送错误信息
  2. 能够获取的Pixiv排行榜更多了

### 2022.10.18
- 新增
  1. 能够获取Pixiv日榜及R18周榜的图片了
***

## TODO
- [x] 在发送了五张图片后再次发送指令能发送下五张图  
- [x] 使用`/sese`发送一张Pixiv随机图片
- [x] 获取新番时间表  
- [x] 保存输出的日志
- [x] 优化发送Pixiv排行榜图片的形式，避免刷屏
- [x] 获取Pixiv排行榜数据后进行缓存，避免短时间内频繁请求
- [ ] 多线程优化
- [x] 拦截同一用户短时间内的多次请求
- [ ] 模块化机器人功能，除基本功能外其余功能以插件形式加载
- [ ] 可以在线进行更新
***

## 第三方API
- [HibiAPI](https://github.com/mixmoe/HibiAPI)
- [一言](https://hitokoto.cn/)
- [Bangumi API](https://bangumi.github.io/api/#/)
- [疯狂星期四文案](https://github.com/whitescent/KFC-Crazy-Thursday)